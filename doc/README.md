# BeanCKUP CLI

BeanCKUP CLI 是一个跨平台的命令行备份与恢复工具，支持高效的增量备份、分卷打包、历史追踪和灵活恢复。适用于个人和团队的数据归档、迁移和灾备场景。

## 主要特性

- **增量备份**：仅打包新增或变更的文件，节省空间和时间。
- **分卷交付**：支持按大小自动分卷，便于大数据量分批交付。
- **历史追踪**：自动记录每次交付的清单，支持文件移动/重命名检测。
- **加密压缩**：集成 7z，支持多级压缩和密码加密。
- **灵活恢复**：可按任意历史会话恢复全部或部分文件，支持智能查找引用文件。
- **断点续传**：支持未完成交付的检测和恢复，程序意外关闭后可继续交付，并可选择继续或开始新任务。
- **智能清理**：自动检测和清理不完整的压缩包，确保交付质量，并在交付中断时提供续传选项。

## 快速开始

### 1. 编译

需安装 Go 1.18+ 和 7z 命令行工具。

```sh
go build -o beanckup-cli main.go
```

### 2. 备份/交付

运行程序，选择"扫描和交付"，按提示选择工作区目录。程序将自动检测工作区状态：
- **新工作区**：未发现历史记录，将开始新的备份。
- **存在未完成交付**：提示您选择继续交付或开始新的扫描。
- **存在完整历史**：将进行增量扫描。
设置交付参数（分卷大小、压缩级别、密码等），即可完成备份。

### 3. 恢复

选择"恢复文件"，指定交付包目录，选择历史会话，输入恢复路径和密码（如有），即可还原文件。



## 目录结构

- `main.go`：主程序入口，菜单交互与流程调度
- `internal/config`：配置管理与工作区路径记忆
- `internal/history`：历史清单与状态加载
- `internal/indexer`：文件扫描与分类（支持进度显示）
- `internal/manifest`：交付清单生成与保存
- `internal/packager`：打包与进度反馈
- `internal/restorer`：恢复流程与智能查找
- `internal/session`：分卷计划与会话管理（支持断点续传）
- `internal/types`：核心数据结构定义
- `internal/util`：工具函数（哈希、时间、密码等）

## 未完成交付恢复功能

### 功能特性
- **自动检测**：在"扫描和交付"流程中自动检测未完成的交付任务。
- **智能清理**：自动检测和删除不完整的压缩包，确保交付质量。
- **断点续传**：支持从任意中断点继续交付，无需重新扫描。
- **状态持久化**：使用标准化的状态文件格式，支持跨会话恢复。

### 使用场景
1. **程序意外关闭**：重新打开后，在"扫描和交付"流程中可选择继续未完成的交付。
2. **手动中断**：中途停止后，在"扫描和交付"流程中可选择继续交付。
3. **灵活控制**：在继续交付时，可重新选择交付路径和总大小限制，直到所有任务完成。

### 状态文件格式
```
工作区/.beanckup/Delivery_Status_工作区名_Sxx_时间戳.json
```

## 依赖

- Go 标准库
- 7z 命令行工具（需在 PATH 中）

## 许可证

MIT
